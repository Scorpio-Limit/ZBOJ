
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./css/css.css">
    <title>ZB OJ | Home</title>
    <style></style>
</head>

<body>
    <!-- Header -->
    <div class="header" id="Div-Header">
        <div class="headerdiv">
            <a id="header-title" href="http://10.31.3.47:9090">&nbsp ZB OJ</a>
            <div
                style="position: fixed; margin-left: 50px; margin-top: -45px; background-color: transparent; width: 400px;">
                <div class="path-item" align="center" onclick="Go('home')" id="path-now">
                    <span>首页</span>
                </div>
                <div class="path-item" align="center" onclick="Go('problem')">
                    <span>题目</span>
                </div>
                <div class="path-item" align="center" onclick="Go('match')">
                    <span>比赛</span>
                </div>
                <div class="path-item" align="center" onclick="Go('eval-all')">
                    <span>测评</span>
                </div>
                <div class="path-item" align="center" onclick="Go('rank')">
                    <span>排名</span>
                </div>
            </div>
            <div align="right" id="LoRe-div">
                <button id="login-button">
                    <span>登陆</span>
                </button>
                <button id="regis-button">
                    <span>注册</span>
                </button>
            </div>
            <div align="right" id="user-box">
                <button id="user-button">
                    <span id="username-text">Scorpio</span>
                </button>
                <div id="user-div" align="center">
                    <button class="app-item" style="margin-top: 5px;" onclick="Go('user-home')">我的主页</button>
                    <button class="app-item" onclick="Go('eval-me')">我的提交</button>
                    <button class="app-item" onclick="Go('setting')">我的设置</button>
                    <button class="app-item" onclick="Go('admin')" id="admin-button">后台管理</button>
                    <div style="margin-top: 5px; width: 100%; height: 1px; background-color: #dedee0;"></div>
                    <button class="app-item" style="margin-top: 5px;" onclick="out()">退出</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login -->
    <div id="login-box">
        <div id="login-div">
            <div id="login-header">
                <h1>欢迎来到 ZB Online Judge</h1>
                <div class="line-box">
                    <div id="line1"></div>
                    <div id="line2"></div>
                </div>
                <div style="height: 1px; background-color: #dddee1;"></div>
                <input id="user-input" type="text" placeholder="用户名">
                <input id="pass-input" type="password" placeholder="密码">
                <button id="login-button-true" onclick="Login()">登陆</button>
                <button class="no-account" onclick="reg()">还没账号，立即注册!</button>
                <button class="no-pass">忘记密码</button>
                <h1 id="wrong1">用户名不可为空</h1>
                <h1 id="wrong2">密码不可为空</h1>
            </div>
        </div>
    </div>

    <!-- reg -->
    <div id="reg-box">
        <div id="reg-div">
            <div id="reg-header">
                <h1>欢迎来到 ZB Online Judge</h1>
                <div class="line-box2">
                    <div id="line3"></div>
                    <div id="line4"></div>
                </div>
                <div style="height: 1px; background-color: #dddee1;"></div>
                <input id="user-input2" type="text" placeholder="用户名">
                <input id="email-input" type="text" placeholder="电子邮箱">
                <input id="pass-input2" type="password" placeholder="密码">
                <input id="pass2-input" type="password" placeholder="确认密码">
                <button id="login-button-true" onclick="Reg()">注册</button>
                <button id="login-button-false" onclick="login()">已经注册？现在登录!</button>
                <h1 id="wrong3">用户名不可为空</h1>
                <h1 id="wrong4">邮箱格式不正确</h1>
                <h1 id="wrong5">密码不可为空</h1>
                <h1 id="wrong6">密码不匹配</h1>
            </div>
        </div>
    </div>

    <div align="center">
        <div id="notice">
            <h1 class="notice-h1">公告</h1>
            <div class="line-notice"></div>
            <h4>欢迎来到 ZB OJ</h4>
            <br><br>
        </div>
        <div id="userbox">
            <h1 class="notice-h1">目前用户</h1>
            <div class="line-notice"></div>
            <br>
            <div class="user-box">
                <h5>用户编号</h5>
                <h5 style="margin-right: 105px;"></h5>
                <h5>用户昵称</h5>
                <h5 style="margin-left: 105px;"></h5>
                <h5>通过题数</h5>
            </div>
            <!-- User List -->
            <div id="userlist"></div>
            <br>
        </div>
    </div>








    <!-- Footer -->
    <br><br><br><br>
    <div id="footer" align="center">
        <span>ZB Online Judge by <a href="https://www.scorpiolimit.top">Scorpio</a></span>
    </div>

    <!-- JavaScript -->
    <script src="./js/js.min.js"></script>
    <script>
        var Path = "10.31.3.47:9090";
        function Go(path) {
            if (path == 'home') {
                window.location.replace(`http://${Path}`);
            }
            else if (path == 'user-home') {
                window.location.replace(`http://${Path}/user-home`);
            }
            else if (path == 'problem') {
                window.location.replace(`http://${Path}/problem`);
            }
            else if (path == 'match') {
                // Somethings.
            }
            else if (path == 'eval-all') {
                window.location.replace(`http://${Path}/eval`);
            }
            else if (path == 'eval-me') {
                window.location.replace(`http://${Path}/eval/myself`);
            }
            else if (path == 'rank') {
                window.location.replace(`http://${Path}/rank`);
            }
            else if (path == 'setting') {
                // Somethings.
            }
            else if (path == 'admin') {
                window.location.replace(`http://${Path}/admin`);
            }
        }
        var flag = 0;
        var flag_app = 0;
        document.querySelector('#user-button').addEventListener('click', function () {
            if (!flag_app) {
                flag_app = 1;
                document.querySelector('#user-button').style = "color: #57a3f3;";
                document.getElementById("user-div").style = "display: block";
            }
            else {
                flag_app = 0;
                document.querySelector('#user-button').style = "color: #414141;";
                document.getElementById("user-div").style = "display: none";
            }
        });
        document.querySelector('.line-box').addEventListener('click', function () {
            document.querySelector('#login-box').style = "display: none; opacity: 0;";
            flag = 0;
        });
        document.querySelector('.line-box2').addEventListener('click', function () {
            document.querySelector('#reg-box').style = "display: none; opacity: 0;";
            flag = 0;
        });
        document.querySelector('#login-button').addEventListener('click', function () {
            document.querySelector('#login-box').style = "display: block; opacity: 1;";
            document.querySelector('#wrong1').style = "opacity: 0;";
            document.querySelector('#wrong2').style = "opacity: 0;";
            flag = 1;
        });
        document.querySelector('#regis-button').addEventListener('click', function () {
            document.querySelector('#reg-box').style = "display: block; opacity: 1;";
            document.querySelector('#wrong3').style = "opacity: 0;";
            document.querySelector('#wrong4').style = "opacity: 0;";
            document.querySelector('#wrong5').style = "opacity: 0;";
            document.querySelector('#wrong6').style = "opacity: 0;";
            flag = 2;
        });
        function CheckEmail(email) {
            const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
            return emailRegex.test(email);
        }
        function login() {
            document.querySelector('#login-box').style = "display: block; opacity: 1;";
            document.querySelector('#reg-box').style = "display: none; opacity: 0;";
            document.querySelector('#wrong1').style = "opacity: 0;";
            document.querySelector('#wrong2').style = "opacity: 0;";
            document.querySelector('#wrong3').style = "opacity: 0;";
            document.querySelector('#wrong4').style = "opacity: 0;";
            document.querySelector('#wrong5').style = "opacity: 0;";
            document.querySelector('#wrong6').style = "opacity: 0;";
            flag = 1;
        }
        function reg() {
            document.querySelector('#reg-box').style = "display: block; opacity: 1;";
            document.querySelector('#login-box').style = "display: none; opacity: 0;";
            document.querySelector('#wrong1').style = "opacity: 0;";
            document.querySelector('#wrong2').style = "opacity: 0;";
            document.querySelector('#wrong3').style = "opacity: 0;";
            document.querySelector('#wrong4').style = "opacity: 0;";
            document.querySelector('#wrong5').style = "opacity: 0;";
            document.querySelector('#wrong6').style = "opacity: 0;";
            flag = 2;
        }
        const userinput = document.querySelector('#user-input');
        const passinput = document.querySelector('#pass-input');
        const userinput2 = document.querySelector('#user-input2');
        const emailinput = document.querySelector('#email-input');
        const passinput2 = document.querySelector('#pass-input2');
        const passinput3 = document.querySelector('#pass2-input');
        userinput.addEventListener('input', function () {
            if (!userinput.value) {
                document.querySelector('#wrong1').innerHTML = '用户名不可为空';
                document.querySelector('#wrong1').style = "opacity: 1;";
            }
            else if (userinput.value.length < 3 || userinput.value.length > 20) {
                document.querySelector('#wrong1').innerHTML = '用户名必须介于3到20个字符之间';
                document.querySelector('#wrong1').style = "opacity: 1;";
            }
            else {
                document.querySelector('#wrong1').style = "opacity: 0;";
            }
        });
        passinput.addEventListener('input', function () {
            if (!passinput.value) {
                document.querySelector('#wrong2').innerHTML = '密码不可为空';
                document.querySelector('#wrong2').style = "opacity: 1;";
            }
            else if (passinput.value.length < 6 || passinput.value.length > 30) {
                document.querySelector('#wrong2').innerHTML = '密码必须介于6到30个字符之间';
                document.querySelector('#wrong2').style = "opacity: 1;";
            }
            else {
                document.querySelector('#wrong2').style = "opacity: 0;";
            }
        });
        userinput2.addEventListener('input', function () {
            if (!userinput2.value) {
                document.querySelector('#wrong3').innerHTML = '用户名不可为空';
                document.querySelector('#wrong3').style = "opacity: 1;";
            }
            else if (userinput2.value.length < 3 || userinput2.value.length > 20) {
                document.querySelector('#wrong3').innerHTML = '用户名必须介于3到20个字符之间';
                document.querySelector('#wrong3').style = "opacity: 1;";
            }
            else {
                document.querySelector('#wrong3').style = "opacity: 0;";
            }
        });
        emailinput.addEventListener('input', function () {
            if (!emailinput.value) {
                document.querySelector('#wrong4').innerHTML = '邮箱不可为空';
                document.querySelector('#wrong4').style = "opacity: 1;";
            }
            else if (CheckEmail(emailinput.value) == false) {
                document.querySelector('#wrong4').innerHTML = '邮箱格式不正确';
                document.querySelector('#wrong4').style = "opacity: 1;";
            }
            else {
                document.querySelector('#wrong4').style = "opacity: 0;";
            }
        });
        passinput2.addEventListener('input', function () {
            if (!passinput2.value) {
                document.querySelector('#wrong5').innerHTML = '密码不可为空';
                document.querySelector('#wrong5').style = "opacity: 1;";
            }
            else if (passinput2.value.length < 6 || passinput2.value.length > 30) {
                document.querySelector('#wrong5').innerHTML = '密码必须介于6到30个字符之间';
                document.querySelector('#wrong5').style = "opacity: 1;";
            }
            else {
                document.querySelector('#wrong5').style = "opacity: 0;";
            }
        });
        passinput3.addEventListener('input', function () {
            if (passinput3.value != passinput2.value) {
                document.querySelector('#wrong6').innerHTML = '密码不匹配';
                document.querySelector('#wrong6').style = "opacity: 1;";
            }
            else {
                document.querySelector('#wrong6').style = "opacity: 0;";
            }
        });
        document.addEventListener("keydown", function (event) {
            if (event.key == "Enter") {
                if (flag == 1) Login();
                else if (flag == 2) Reg();
            }
        });
        function UserList() {
            fetch('http://10.31.3.47:9900/api/userlist')
                .then(response => response.json())
                .then(data => {
                    const UserList = document.getElementById('userlist');
                    UserList.innerHTML = '';
                    data.forEach(list => {
                        const userbox = document.createElement('div');
                        userbox.classList.add('user-box');
                        userbox.onclick = function () {
                            window.location.replace(`http://${Path}/user-home/user/?uid=${list.uid}`);
                        }
                        const uid = document.createElement('h5');
                        uid.classList.add('user-uid');
                        uid.innerHTML = list.uid;
                        const userleft = document.createElement('h5');
                        userleft.classList.add('user-left');
                        const name = document.createElement('h5');
                        name.classList.add('user-name-h5');
                        name.innerHTML = list.name;
                        const userright = document.createElement('h5');
                        userright.classList.add('user-right');
                        const pro = document.createElement('h5');
                        pro.classList.add('user-pro');
                        pro.innerHTML = list.pro;
                        userbox.appendChild(uid);
                        userbox.appendChild(userleft);
                        userbox.appendChild(name);
                        userbox.appendChild(userright);
                        userbox.appendChild(pro);
                        UserList.appendChild(userbox);
                    });
                })
                .catch(error => {
                    // window.alert('接受信息失败');
                });
        }
        function init() {
            document.querySelector('#login-box').style = "display: none;";
            document.querySelector('#reg-box').style = "display: none;";
            UserList();
        }
        init();
    </script>
</body>

</html>
